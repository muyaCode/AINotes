import{_ as n,c as a,o as l,a4 as p}from"./chunks/framework.DBIahkuf.js";const e="/AINotes/assets/d0edccfe4c94488a938806a5c6af8561.C6xcGemL.webp",o="/AINotes/assets/90a7cf0ca66a4c2ab897e8b8f3550695.I7XIjEHf.webp",t="/AINotes/assets/c471d7c9ddb847acb3d4f827f17db80b.CQFgyS6d.webp",r="/AINotes/assets/00c538205a9d4112a8e7dc0d69150a8b.Ctkk4cDt.webp",c="/AINotes/assets/60043a314f5a45f0a4c5c4007170e894.BmvJg1uU.webp",i="/AINotes/assets/457d42bb3b354731a7ef653d0360a459.DRRD-Qpr.webp",y="/AINotes/assets/a37ac07d88d04e84a13b2138090638cb.BYV2BMI1.webp",B="/AINotes/assets/d45a22fb86ef42c4a4c84951d16b96e7.6jKeEfcE.webp",b="/AINotes/assets/754c80dd8feb456faf5e2229109b1d2d.BRQkkWAx.webp",u="/AINotes/assets/2aa07f0d961847988dfa35283ef3eddf.mV0byml_.webp",d="/AINotes/assets/ab58d1442f91473999f9870892357c43.x1DpJHcm.webp",m="/AINotes/assets/2f20a1e72f104591928707a44402e45f.BuJEUWuB.webp",A="/AINotes/assets/e59caacc4afa49dba6d614e9ce54326d.BohESoeT.webp",s="data:image/webp;base64,UklGRkAAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAIAAAAAAFZQOCAYAAAAMAEAnQEqAQABAAIANCWkAANwAP77/VAA",F="/AINotes/assets/d5c46385ffca4c789f60f48052bfdd0b.CgB-c4Wb.webp",C="/AINotes/assets/087a97b98f584fb584042f71817a3a5d.WVk2Kptt.webp",h="/AINotes/assets/a09c44f3d6ba4bf89a58ca5a228fbd18.D7tAFpX8.webp",f="/AINotes/assets/01c9004daa7c4311a2997d746e79dc43.BnAHXDUI.webp",L=JSON.parse('{"title":"如何快速创建一个 ChatGPT 机器人","description":"","frontmatter":{},"headers":[],"relativePath":"Document/问答类语言模型/ChatGPT注册使用和扩展/ChatGPT应用开发/如何快速创建一个 ChatGPT 机器人.md","filePath":"Document/问答类语言模型/ChatGPT注册使用和扩展/ChatGPT应用开发/如何快速创建一个 ChatGPT 机器人.md","lastUpdated":1690705202000}'),g={name:"Document/问答类语言模型/ChatGPT注册使用和扩展/ChatGPT应用开发/如何快速创建一个 ChatGPT 机器人.md"},D=p('<h1 id="如何快速创建一个-chatgpt-机器人" tabindex="-1">如何快速创建一个 ChatGPT 机器人 <a class="header-anchor" href="#如何快速创建一个-chatgpt-机器人" aria-label="Permalink to &quot;如何快速创建一个 ChatGPT 机器人&quot;">​</a></h1><p>ChatGPT搭建微信聊天机器人：<a href="https://github.com/zhayujie/chatgpt-on-wechat" target="_blank" rel="noreferrer">zhayujie/chatgpt-on-wechat: Wechat robot based on ChatGPT, which using OpenAI api and itchat library. 使用ChatGPT搭建微信聊天机器人，基于GPT3.5/4.0 API实现，支持个人微信、公众号、企业微信部署，能处理文本、语音和图片，访问操作系统和互联网。 (github.com)</a></p><p><a href="https://github.com/bupticybee/ChineseAiDungeonChatGPT" target="_blank" rel="noreferrer">bupticybee/ChineseAiDungeonChatGPT: 中文版的ai地牢，直接使用的openai的ChatGPT api作为讲故事的模型。 (github.com)</a></p><h2 id="gpt4all-chatgpt本地私有化部署-终生免费" tabindex="-1">GPT4All：ChatGPT本地私有化部署,终生免费 <a class="header-anchor" href="#gpt4all-chatgpt本地私有化部署-终生免费" aria-label="Permalink to &quot;GPT4All：ChatGPT本地私有化部署,终生免费&quot;">​</a></h2><h3 id="gpt4all是什么" tabindex="-1">GPT4All是什么 <a class="header-anchor" href="#gpt4all是什么" aria-label="Permalink to &quot;GPT4All是什么&quot;">​</a></h3><p>根据官方网站GPT4All的描述，它是一个免费使用、本地运行的、注重隐私的聊天机器人。不需要GPU或互联网。</p><p>GTP4All是一个生态系统，用于训练和部署在消费级CPU上本地运行的强大且定制的大型语言模型。</p><p>我们的GPT4All模型是一个4GB的文件，您可以下载并连接到GPT4All开源生态系统软件中。Nomic AI提供高质量和安全的软件生态系统，努力实现个人和组织轻松训练和本地实施自己的大型语言模型。</p><h3 id="它是如何工作的" tabindex="-1">它是如何工作的？ <a class="header-anchor" href="#它是如何工作的" aria-label="Permalink to &quot;它是如何工作的？&quot;">​</a></h3><p><img src="'+e+'" alt="img"></p><p>该过程非常简单（当您了解之后），并且可以在其他模型上重复。具体步骤如下：</p><ul><li>加载GPT4All模型</li><li>使用Langchain检索并加载我们的文档</li><li>将文档分割成小块，以便嵌入式能够理解</li><li>使用FAISS根据我们要传递给GPT4All的问题创建嵌入式向量数据库</li><li>在基于问题的语境中在嵌入式向量数据库上执行相似性搜索（语义搜索）：这将作为我们问题的上下文</li><li>使用Langchain将问题和上下文提供给GPT4All，并等待答案。</li></ul><p>所以我们需要的是嵌入式向量。嵌入式向量是一条信息的数值表示，例如文本、文档、图像、音频等。该表示捕捉了被嵌入的语义含义，这正是我们所需要的。对于这个项目，我们无法依赖于重型GPU模型：因此，我们将下载Alpaca原生模型，并使用Langchain中的LlamaCppEmbeddings。不用担心！每一步都有详细的解释。</p><h3 id="let-s-start-coding" tabindex="-1">Let’s start coding <a class="header-anchor" href="#let-s-start-coding" aria-label="Permalink to &quot;Let’s start coding&quot;">​</a></h3><p><strong>创建虚拟环境</strong>:</p><p>为你的新Python项目创建一个新的文件夹，例如GPT4ALL_Fabio（请用你的名字替换Fabio）：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">mkdir </span><span style="color:#D19A66;">GPT4ALL_Fabiocd</span><span style="color:#D19A66;"> GPT4ALL_Fabio</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>接下来，创建一个新的Python虚拟环境。如果你安装了多个Python版本，请指定你想要使用的版本。在这个例子中，我将使用与Python 3.10关联的主要安装。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">python3 </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">m venv .venv</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>命令python3 -m venv .venv创建了一个名为.venv的新虚拟环境（点号会创建一个名为venv的隐藏目录）。</p><p>虚拟环境提供了一个隔离的Python安装环境，允许你仅针对特定项目安装软件包和依赖项，而不会影响系统范围的Python安装或其他项目。这种隔离有助于保持一致性，并防止不同项目需求之间的潜在冲突。</p><p>一旦虚拟环境创建好了，你可以使用以下命令来激活它：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">source .venv</span><span style="color:#56B6C2;">/bin/</span><span style="color:#ABB2BF;">activate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="'+o+`" alt="img"></p><p><strong>安装依赖</strong>:</p><p>对于我们正在构建的项目，我们不需要太多的软件包。我们只需要以下几个：</p><ul><li>GPT4All的Python绑定</li><li>Langchain用于与我们的文档交互</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">pip install pygpt4all</span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;">1.0</span><span style="color:#ABB2BF;">.1</span></span>
<span class="line"><span style="color:#ABB2BF;">pip install pyllamacpp</span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;">1.0</span><span style="color:#ABB2BF;">.6</span></span>
<span class="line"><span style="color:#ABB2BF;">pip install langchain</span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;">0.0</span><span style="color:#ABB2BF;">.149</span></span>
<span class="line"><span style="color:#ABB2BF;">pip install unstructured</span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;">0.6</span><span style="color:#ABB2BF;">.5</span></span>
<span class="line"><span style="color:#ABB2BF;">pip install pdf2image</span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;">1.16</span><span style="color:#ABB2BF;">.3</span></span>
<span class="line"><span style="color:#ABB2BF;">pip install pytesseract</span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;">0.3</span><span style="color:#ABB2BF;">.10</span></span>
<span class="line"><span style="color:#ABB2BF;">pip install pypdf</span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;">3.8</span><span style="color:#ABB2BF;">.1</span></span>
<span class="line"><span style="color:#ABB2BF;">pip install faiss</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">cpu</span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;">1.7</span><span style="color:#ABB2BF;">.4</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对于LangChain，你可以看到我们指定了版本号。这个库最近正在接受很多更新，所以为了确保我们的设置明天也能正常工作，最好指定一个我们知道能正常工作的版本。Unstructured是pdf加载器、pytesseract和pdf2image的必需依赖库。</p><p>注意：GitHub存储库中有一个requirements.txt文件，其中包含与此项目相关的所有版本。你可以在将其下载到主项目文件目录后，使用以下命令一次性进行安装：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">pip install </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">r requirements.txt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>请记住，某些库有根据你在虚拟环境中运行的Python版本提供的不同版本可用。</p><p><strong>下载模型</strong>:</p><p>这是一个非常重要的步骤。</p><p>对于这个项目，我们当然需要</p><p>GPT4All模型。在Nomic AI网站上描述的过程非常复杂，并且需要一些我们不一定都拥有的硬件（比如我）。所以这里是已经转换并准备好使用的模型链接。只需点击下载。</p><p><img src="`+t+'" alt="img"></p><p>正如简介中简要描述的，我们还需要嵌入模型，这是一个可以在我们的CPU上运行而不会崩溃的模型。点击这里的链接【<a href="https://huggingface.co/Pi3141/alpaca-native-7B-ggml/blob/397e872bf4c83f4c642317a5bf65ce84a105786e/ggml-model-q4_0.bin%E3%80%91%E4%B8%8B%E8%BD%BD%E5%B7%B2%E7%BB%8F%E8%BD%AC%E6%8D%A2%E4%B8%BA4%E4%BD%8D%E5%B9%B6%E5%87%86%E5%A4%87%E5%A5%BD%E7%94%A8%E4%BD%9C%E5%B5%8C%E5%85%A5%E6%A8%A1%E5%9E%8B%E7%9A%84alpaca-native-7B-ggml%E6%A8%A1%E5%9E%8B%E3%80%82" target="_blank" rel="noreferrer">huggingface.co/Pi3141/alpa…</a></p><p><img src="'+r+'" alt="img"></p><p>为什么我们需要嵌入？如果你还记得流程图中的第一步，在收集知识库文档之后，我们需要将它们嵌入。LLamaCPP嵌入来自Alpaca模型，非常适合这项工作，而且这个模型也很小（4 GB）。顺便说一下，你也可以在问答环节中使用Alpaca模型！</p><p>2023.05.25更新：Mani Windows用户在使用llamaCPP嵌入时遇到了问题。这主要是因为在安装python包llama-cpp-python时使用了以下命令：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">pip install llama</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">cpp</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">python</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这个命令会从源代码编译库。通常Windows上的机器默认没有安装CMake或C编译器。但不要担心，有解决办法。</p><p>在Windows上运行llama-cpp-python的安装过程时，需要编译源代码，但由于Windows默认没有安装CMake和C编译器，因此无法从源代码构建。</p><p>在Mac用户使用Xtools和Linux用户上，通常操作系统中已经安装了C编译器。</p><p><strong>为了避免问题，你必须使用预编译的wheel。</strong></p><p>访问<a href="https://github.com/abetlen/llama-cpp-python/releases" target="_blank" rel="noreferrer">github.com/abetlen/lla…</a></p><p>找到适用于你架构和Python版本的预编译的wheel版本，你必须选择0.1.49版本，因为更高的版本不兼容。</p><p><img src="'+c+'" alt="img"></p><p>在我这里，我使用的是Windows 10 64位，Python 3.10</p><p>所以我的文件是llama_cpp_python-0.1.49-cp310-cp310-win_amd64.whl</p><p>这个问题在GitHub存储库中有记录【<a href="https://github.com/fabiomatricardi/GPT4All_Medium/issues/2%E3%80%91%E3%80%82" target="_blank" rel="noreferrer">github.com/fabiomatric…</a></p><p>下载完成后，你需要将这两个模型文件放到models目录中，如下所示。</p><p><img src="'+i+`" alt="img"></p><p>目录结构和放置模型文件的位置</p><h3 id="与gpt4all的基本交互" tabindex="-1">与GPT4All的基本交互 <a class="header-anchor" href="#与gpt4all的基本交互" aria-label="Permalink to &quot;与GPT4All的基本交互&quot;">​</a></h3><p>由于我们想要对GPT模型的交互进行控制，我们需要创建一个Python文件（我们称之为pygpt4all_test.py），导入依赖项并给模型发送指令。你会发现这很容易。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> pygpt4all.models.gpt4all </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> GPT4All</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这是我们模型的Python绑定。现在我们可以调用它并开始提问。让我们试一个有创意的问题。</p><p>我们创建一个函数来读取模型的回调，并要求GPT4All完成我们的句子。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> new_text_callback</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">text</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(text, </span><span style="color:#E06C75;font-style:italic;">end</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">model </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> GPT4All</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./models/gpt4all-converted.bin&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">model.</span><span style="color:#61AFEF;">generate</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Once upon a time, &quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">n_predict</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">55</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">new_text_callback</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">new_text_callback)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第一条语句告诉我们的程序在哪里找到模型（记住我们在上面的部分所做的事情）。</p><p>第二条语句要求模型生成一个回答，并完成我们的提示文本 &quot;Once upon a time,&quot;。</p><p>要运行它，请确保虚拟环境仍处于激活状态，然后简单地运行：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">python3 pygpt4all_test.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>你应该会看到模型正在加载的文本和句子的完成。根据你的硬件资源，这可能需要一些时间。</p><p><img src="`+y+`" alt="img"></p><p>结果可能与你的不同... 但对我们来说重要的是它正在工作，我们可以继续使用LangChain创建一些高级功能。</p><p>注意（更新于2023.05.23）：如果你遇到与pygpt4all相关的错误，请查看故障排除部分，其中提供了由Rajneesh Aggarwal或Oscar Jeong给出的解决方案。</p><h3 id="langchain在gpt4all上的模板" tabindex="-1">LangChain在GPT4All上的模板 <a class="header-anchor" href="#langchain在gpt4all上的模板" aria-label="Permalink to &quot;LangChain在GPT4All上的模板&quot;">​</a></h3><p>LangChain框架是一个非常强大的库。它提供了组件，以一种易于使用的方式与语言模型进行交互，并且还提供了Chains。可以将Chains视为以特定方式组装这些组件，以最好地完成特定的用例。它们旨在成为一个更高级的接口，使人们能够轻松地开始使用特定的用例。这些Chains也可以进行定制。</p><p>在我们的下一个Python测试中，我们将使用一个Prompt Template。语言模型接受文本作为输入，这段文本通常被称为prompt。通常情况下，这不仅仅是一个硬编码的字符串，而是模板、示例和用户输入的组合。LangChain提供了多个类和函数，使构建和处理prompt变得简单。让我们看看如何实现。</p><p>创建一个新的Python文件，命名为my_langchain.py。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Import of langchain Prompt Template and Chain</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> PromptTemplate, LLMChain</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Import llm to be able to interact with GPT4All directly from langchain</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.llms </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> GPT4All</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Callbacks manager is required for the response handling </span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.callbacks.base </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> CallbackManager</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.callbacks.streaming_stdout </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> StreamingStdOutCallbackHandler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">local_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./models/gpt4all-converted.bin&#39;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">callback_manager </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> CallbackManager</span><span style="color:#ABB2BF;">([</span><span style="color:#61AFEF;">StreamingStdOutCallbackHandler</span><span style="color:#ABB2BF;">()])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>我们从LangChain中导入了Prompt Template和Chain，以及GPT4All llm类，以便能够直接与我们的GPT模型进行交互。</p><p>然后，在设置了llm路径之后（与之前一样），我们实例化了回调管理器，以便能够捕获我们查询的响应。</p><p>创建一个模板非常简单：根据文档教程，我们可以使用如下代码：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">template </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;&quot;Question: </span><span style="color:#D19A66;">{question}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">Answer: Let&#39;s think step by step on it.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">prompt </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PromptTemplate</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">template</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">template, </span><span style="color:#E06C75;font-style:italic;">input_variables</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;question&quot;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>template变量是一个多行字符串，包含了与模型的交互结构：在花括号中插入模板的外部变量，对于我们的情况就是问题。</p><p>由于它是一个变量，你可以决定它是一个硬编码的问题还是用户输入的问题：这里是两个示例。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Hardcoded question</span></span>
<span class="line"><span style="color:#ABB2BF;">question </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;What Formula 1 pilot won the championship in the year Leonardo di Caprio was born?&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># User input question...</span></span>
<span class="line"><span style="color:#ABB2BF;">question </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Enter your question: &quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>对于我们的测试运行，我们将注释掉用户输入的问题。现在我们只需要将我们的模板、问题和语言模型连接在一起。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">template </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;&quot;Question: </span><span style="color:#D19A66;">{question}</span></span>
<span class="line"><span style="color:#98C379;">Answer: Let&#39;s think step by step on it.</span></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">prompt </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PromptTemplate</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">template</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">template, </span><span style="color:#E06C75;font-style:italic;">input_variables</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;question&quot;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># initialize the GPT4All instance</span></span>
<span class="line"><span style="color:#ABB2BF;">llm </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> GPT4All</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">model</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">local_path, </span><span style="color:#E06C75;font-style:italic;">callback_manager</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">callback_manager, </span><span style="color:#E06C75;font-style:italic;">verbose</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># link the language model with our prompt template</span></span>
<span class="line"><span style="color:#ABB2BF;">llm_chain </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> LLMChain</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">prompt</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">prompt, </span><span style="color:#E06C75;font-style:italic;">llm</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">llm)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Hardcoded question</span></span>
<span class="line"><span style="color:#ABB2BF;">question </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;What Formula 1 pilot won the championship in the year Leonardo di Caprio was born?&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># User imput question...</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># question = input(&quot;Enter your question: &quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#Run the query and get the results</span></span>
<span class="line"><span style="color:#ABB2BF;">llm_chain.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(question)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>记得验证你的虚拟环境仍然处于激活状态，并运行以下命令：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">python3 my_langchain.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>你可能会得到与我不同的结果。令人惊奇的是，你可以看到GPT4All在尝试为你找到答案时所遵循的整个推理过程。调整问题可能会得到更好的结果。</p><p><img src="`+B+`" alt="img"></p><h3 id="使用langchain和gpt4all回答关于文件的问题" tabindex="-1">使用LangChain和GPT4All回答关于文件的问题 <a class="header-anchor" href="#使用langchain和gpt4all回答关于文件的问题" aria-label="Permalink to &quot;使用LangChain和GPT4All回答关于文件的问题&quot;">​</a></h3><p>在这里，我们开始了令人惊奇的部分，因为我们将使用GPT4All作为一个聊天机器人来回答我们的问题。</p><p>根据与GPT4All进行问答的工作流程，我们需要加载我们的PDF文件，并将其分成块。接下来，我们需要为我们的嵌入向量准备一个向量存储库。我们需要将我们的分块文档输入到向量存储库中进行信息检索，然后将它们与该数据库上的相似性搜索一起作为LLM查询的上下文进行嵌入。</p><p>为此，我们将直接使用Langchain库中的FAISS。FAISS是Facebook AI Research开发的开源库，旨在快速在大规模高维数据集中查找相似项。它提供索引和搜索方法，使得在数据集中快速找到最相似的项变得更加简单和快速。对我们来说特别方便的是，它简化了信息检索，并允许我们本地保存创建的数据库：这意味着在第一次创建后，将非常快速地加载数据库以供以后使用。</p><p><strong>创建向量索引数据库</strong>:</p><p>创建一个新的文件叫做 my_knowledge_qna.py：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> PromptTemplate, LLMChain</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.llms </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> GPT4All</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.callbacks.base </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> CallbackManager</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.callbacks.streaming_stdout </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> StreamingStdOutCallbackHandler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># function for loading only TXT files</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.document_loaders </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> TextLoader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># text splitter for create chunks</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.text_splitter </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> RecursiveCharacterTextSplitter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># to be able to load the pdf files</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.document_loaders </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> UnstructuredPDFLoader</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.document_loaders </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> PyPDFLoader</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.document_loaders </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> DirectoryLoader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Vector Store Index to create our database about our knowledge</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.indexes </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> VectorstoreIndexCreator</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># LLamaCpp embeddings from the Alpaca model</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.embeddings </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> LlamaCppEmbeddings</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># FAISS  library for similaarity search</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.vectorstores.faiss </span><span style="color:#C678DD;">import</span><span style="color:#D19A66;"> FAISS</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os  </span><span style="color:#7F848E;font-style:italic;">#for interaaction with the files</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>第一组库与之前使用的相同：另外我们使用Langchain进行向量存储索引的创建，使用LlamaCppEmbeddings与我们的Alpaca模型进行交互（使用cpp库进行4位量化和编译），以及PDF加载器。</p><p>我们还要加载具有自己路径的LLMs：一个用于嵌入和一个用于文本生成。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># assign the path for the 2 models GPT4All and Alpaca for the embeddings </span></span>
<span class="line"><span style="color:#ABB2BF;">gpt4all_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./models/gpt4all-converted.bin&#39;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">llama_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./models/ggml-model-q4_0.bin&#39;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Calback manager for handling the calls with  the model</span></span>
<span class="line"><span style="color:#ABB2BF;">callback_manager </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> CallbackManager</span><span style="color:#ABB2BF;">([</span><span style="color:#61AFEF;">StreamingStdOutCallbackHandler</span><span style="color:#ABB2BF;">()])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># create the embedding object</span></span>
<span class="line"><span style="color:#ABB2BF;">embeddings </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> LlamaCppEmbeddings</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">model_path</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">llama_path)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># create the GPT4All llm object</span></span>
<span class="line"><span style="color:#ABB2BF;">llm </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> GPT4All</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">model</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">gpt4all_path, </span><span style="color:#E06C75;font-style:italic;">callback_manager</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">callback_manager, </span><span style="color:#E06C75;font-style:italic;">verbose</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>为了测试，让我们看看是否成功读取了所有的PDF文件：第一步是声明三个函数，用于处理每个单独的文档。第一个函数是将提取的文本分割成块，第二个函数是创建带有元数据的向量索引（例如页码等），最后一个函数是用于测试相似性搜索（稍后我将更详细地解释）。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Split text </span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> split_chunks</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">sources</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    chunks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">    splitter </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> RecursiveCharacterTextSplitter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">chunk_size</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">256</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">chunk_overlap</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">32</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> chunk </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> splitter.</span><span style="color:#61AFEF;">split_documents</span><span style="color:#ABB2BF;">(sources):</span></span>
<span class="line"><span style="color:#ABB2BF;">        chunks.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(chunk)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> chunks</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> create_index</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">chunks</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    texts </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [doc.page_content </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> doc </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> chunks]</span></span>
<span class="line"><span style="color:#ABB2BF;">    metadatas </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [doc.metadata </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> doc </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> chunks]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    search_index </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> FAISS</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">from_texts</span><span style="color:#ABB2BF;">(texts, embeddings, </span><span style="color:#E06C75;font-style:italic;">metadatas</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">metadatas)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> search_index</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> similarity_search</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">query</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">index</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # k is the number of similarity searched that matches the query</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # default is 4</span></span>
<span class="line"><span style="color:#ABB2BF;">    matched_docs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> index.</span><span style="color:#61AFEF;">similarity_search</span><span style="color:#ABB2BF;">(query, </span><span style="color:#E06C75;font-style:italic;">k</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#ABB2BF;">    sources </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> doc </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> matched_docs:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sources.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">            {</span></span>
<span class="line"><span style="color:#98C379;">                &quot;page_content&quot;</span><span style="color:#ABB2BF;">: doc.page_content,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;metadata&quot;</span><span style="color:#ABB2BF;">: doc.metadata,</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> matched_docs, sources</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>现在我们可以测试文档目录中的索引生成：我们需要将所有的PDF文件放在那里。Langchain还有一种加载整个文件夹的方法，不论文件类型如何：由于后续处理比较复杂，我将在下一篇关于LaMini模型的文章中介绍。</p><p><img src="`+b+`" alt="img"></p><p>我们将把这些函数应用到列表中的第一个文档上。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># get the list of pdf files from the docs directory into a list  format</span></span>
<span class="line"><span style="color:#ABB2BF;">pdf_folder_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./docs&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">doc_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [s </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> s </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(pdf_folder_path) </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> s.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.pdf&#39;</span><span style="color:#ABB2BF;">)]</span></span>
<span class="line"><span style="color:#ABB2BF;">num_of_docs </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(doc_list)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># create a loader for the PDFs from the path</span></span>
<span class="line"><span style="color:#ABB2BF;">loader </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PyPDFLoader</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(pdf_folder_path, doc_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># load the documents with Langchain</span></span>
<span class="line"><span style="color:#ABB2BF;">docs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> loader.</span><span style="color:#61AFEF;">load</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Split in chunks</span></span>
<span class="line"><span style="color:#ABB2BF;">chunks </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> split_chunks</span><span style="color:#ABB2BF;">(docs)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># create the db vector index</span></span>
<span class="line"><span style="color:#ABB2BF;">db0 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> create_index</span><span style="color:#ABB2BF;">(chunks)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在第一行中，我们使用os库来获取docs目录中的PDF文件列表。然后，我们使用Langchain加载docs文件夹中的第一个文档（doc_list[0]），将其分割成块，然后使用LLama嵌入创建向量数据库。</p><p>正如您所看到的，我们使用了pyPDF方法。这个方法稍微复杂一些，因为您需要逐个加载文件，但是使用pypdf将PDF加载到文档数组中使您能够得到一个数组，其中每个文档都包含页面内容和带有页码的元数据。当您想要知道我们将通过查询提供给GPT4All的上下文的来源时，这非常方便。以下是来自readthedocs的示例：</p><p><img src="`+u+'" alt="img"></p><p>然后执行下面的命令运行：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">python3 my_knowledge_qna.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>在加载用于嵌入的模型之后，您将看到令牌在索引中的工作方式：不要惊慌，因为这需要时间，特别是如果您只在CPU上运行，就像我一样（这需要8分钟）。</p><p><img src="'+d+`" alt="img"></p><p>正如我之前解释的，pyPDF方法较慢，但为我们提供了用于相似性搜索的额外数据。为了遍历所有文件，我们将使用FAISS中的一种便捷方法，它允许我们将不同的数据库合并在一起。现在我们做的是使用上面的代码生成第一个数据库（我们将其称为db0），然后使用for循环创建列表中下一个文件的索引，并立即将其与db0合并。</p><p>以下是代码：请注意，我添加了一些日志，以便使用datetime.datetime.now()提供进度状态，并打印结束时间和开始时间的差值来计算操作所需的时间（如果您不喜欢，可以将其删除）。</p><p>合并指令如下：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># merge dbi with the existing db0db0.merge_from(dbi)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>最后一条指令是将我们的数据库保存到本地：整个生成过程可能需要数小时（取决于文档的数量），所以我们只需执行一次这个操作非常好！</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Save the databasae locallydb0.save_local(&quot;my_faiss_index&quot;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>以下是完整的代码。当我们与GPT4All互动并直接从文件夹加载索引时，我们将对其中许多部分进行注释。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># get the list of pdf files from the docs directory into a list  format</span></span>
<span class="line"><span style="color:#ABB2BF;">pdf_folder_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./docs&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">doc_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [s </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> s </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(pdf_folder_path) </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> s.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.pdf&#39;</span><span style="color:#ABB2BF;">)]</span></span>
<span class="line"><span style="color:#ABB2BF;">num_of_docs </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(doc_list)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># create a loader for the PDFs from the path</span></span>
<span class="line"><span style="color:#ABB2BF;">general_start </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">#not used now but useful</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;starting the loop...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">loop_start </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">#not used now but useful</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;generating fist vector database and then iterate with .merge_from&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">loader </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PyPDFLoader</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(pdf_folder_path, doc_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">docs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> loader.</span><span style="color:#61AFEF;">load</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">chunks </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> split_chunks</span><span style="color:#ABB2BF;">(docs)</span></span>
<span class="line"><span style="color:#ABB2BF;">db0 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> create_index</span><span style="color:#ABB2BF;">(chunks)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Main Vector database created. Start iteration and merging...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">,num_of_docs):</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(doc_list[i])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;loop position </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">i</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    loader </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PyPDFLoader</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(pdf_folder_path, doc_list[i]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    start </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">#not used now but useful</span></span>
<span class="line"><span style="color:#ABB2BF;">    docs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> loader.</span><span style="color:#61AFEF;">load</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    chunks </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> split_chunks</span><span style="color:#ABB2BF;">(docs)</span></span>
<span class="line"><span style="color:#ABB2BF;">    dbi </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> create_index</span><span style="color:#ABB2BF;">(chunks)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;start merging with db0...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    db0.</span><span style="color:#61AFEF;">merge_from</span><span style="color:#ABB2BF;">(dbi)</span></span>
<span class="line"><span style="color:#ABB2BF;">    end </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">#not used now but useful</span></span>
<span class="line"><span style="color:#ABB2BF;">    elapsed </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> end </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> start </span><span style="color:#7F848E;font-style:italic;">#not used now but useful</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #total time</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;completed in </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">elapsed</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-----------------------------------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">loop_end </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">#not used now but useful</span></span>
<span class="line"><span style="color:#ABB2BF;">loop_elapsed </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> loop_end </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> loop_start </span><span style="color:#7F848E;font-style:italic;">#not used now but useful</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;All documents processed in </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">loop_elapsed</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;the daatabase is done with </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">num_of_docs</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> subset of db index&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-----------------------------------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Merging completed&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-----------------------------------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Saving Merged Database Locally&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Save the databasae locally</span></span>
<span class="line"><span style="color:#ABB2BF;">db0.</span><span style="color:#61AFEF;">save_local</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;my_faiss_index&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-----------------------------------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;merged database saved as my_faiss_index&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">general_end </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">#not used now but useful</span></span>
<span class="line"><span style="color:#ABB2BF;">general_elapsed </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> general_end </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> general_start </span><span style="color:#7F848E;font-style:italic;">#not used now but useful</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;All indexing completed in </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">general_elapsed</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-----------------------------------&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p><img src="`+m+`" alt="img"></p><p><strong>向GPT4All提问关于您的文档的问题</strong>:</p><p>现在我们到了这一步。我们有了我们的索引，我们可以加载它，并使用一个提示模板向GPT4All提问。我们先从一个硬编码的问题开始，然后循环遍历我们的输入问题。</p><p>将以下代码放入一个名为 db_loading.py 的 Python 文件中，并在终端中使用 python3 db_loading.py 命令运行它:</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> PromptTemplate, LLMChain</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.llms </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> GPT4All</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.callbacks.base </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> CallbackManager</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.callbacks.streaming_stdout </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> StreamingStdOutCallbackHandler</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># function for loading only TXT files</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.document_loaders </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> TextLoader</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># text splitter for create chunks</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.text_splitter </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> RecursiveCharacterTextSplitter</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># to be able to load the pdf files</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.document_loaders </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> UnstructuredPDFLoader</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.document_loaders </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> PyPDFLoader</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.document_loaders </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> DirectoryLoader</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Vector Store Index to create our database about our knowledge</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.indexes </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> VectorstoreIndexCreator</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># LLamaCpp embeddings from the Alpaca model</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.embeddings </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> LlamaCppEmbeddings</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># FAISS  library for similaarity search</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> langchain.vectorstores.faiss </span><span style="color:#C678DD;">import</span><span style="color:#D19A66;"> FAISS</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os  </span><span style="color:#7F848E;font-style:italic;">#for interaaction with the files</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># TEST FOR SIMILARITY SEARCH</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># assign the path for the 2 models GPT4All and Alpaca for the embeddings </span></span>
<span class="line"><span style="color:#ABB2BF;">gpt4all_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./models/gpt4all-converted.bin&#39;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">llama_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./models/ggml-model-q4_0.bin&#39;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Calback manager for handling the calls with  the model</span></span>
<span class="line"><span style="color:#ABB2BF;">callback_manager </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> CallbackManager</span><span style="color:#ABB2BF;">([</span><span style="color:#61AFEF;">StreamingStdOutCallbackHandler</span><span style="color:#ABB2BF;">()])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># create the embedding object</span></span>
<span class="line"><span style="color:#ABB2BF;">embeddings </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> LlamaCppEmbeddings</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">model_path</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">llama_path)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># create the GPT4All llm object</span></span>
<span class="line"><span style="color:#ABB2BF;">llm </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> GPT4All</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">model</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">gpt4all_path, </span><span style="color:#E06C75;font-style:italic;">callback_manager</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">callback_manager, </span><span style="color:#E06C75;font-style:italic;">verbose</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Split text </span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> split_chunks</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">sources</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    chunks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">    splitter </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> RecursiveCharacterTextSplitter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">chunk_size</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">256</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">chunk_overlap</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">32</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> chunk </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> splitter.</span><span style="color:#61AFEF;">split_documents</span><span style="color:#ABB2BF;">(sources):</span></span>
<span class="line"><span style="color:#ABB2BF;">        chunks.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(chunk)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> chunks</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> create_index</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">chunks</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    texts </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [doc.page_content </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> doc </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> chunks]</span></span>
<span class="line"><span style="color:#ABB2BF;">    metadatas </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [doc.metadata </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> doc </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> chunks]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    search_index </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> FAISS</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">from_texts</span><span style="color:#ABB2BF;">(texts, embeddings, </span><span style="color:#E06C75;font-style:italic;">metadatas</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">metadatas)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> search_index</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> similarity_search</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">query</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">index</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # k is the number of similarity searched that matches the query</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # default is 4</span></span>
<span class="line"><span style="color:#ABB2BF;">    matched_docs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> index.</span><span style="color:#61AFEF;">similarity_search</span><span style="color:#ABB2BF;">(query, </span><span style="color:#E06C75;font-style:italic;">k</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#ABB2BF;">    sources </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> doc </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> matched_docs:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sources.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">            {</span></span>
<span class="line"><span style="color:#98C379;">                &quot;page_content&quot;</span><span style="color:#ABB2BF;">: doc.page_content,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;metadata&quot;</span><span style="color:#ABB2BF;">: doc.metadata,</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> matched_docs, sources</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Load our local index vector db</span></span>
<span class="line"><span style="color:#ABB2BF;">index </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> FAISS</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">load_local</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;my_faiss_index&quot;</span><span style="color:#ABB2BF;">, embeddings)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Hardcoded question</span></span>
<span class="line"><span style="color:#ABB2BF;">query </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;What is a PLC and what is the difference with a PC&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">docs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> index.</span><span style="color:#61AFEF;">similarity_search</span><span style="color:#ABB2BF;">(query)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Get the matches best 3 results - defined in the function k=3</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;The question is: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">query</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Here the result of the semantic search on the index, without GPT4All..&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(docs[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><p>打印的文本是与查询最匹配的前3个来源的列表，还提供了文档名称和页码。</p><p><img src="`+A+`" alt="img"></p><p>现在我们可以使用相似性搜索作为查询的上下文，使用提示模板。在这3个函数之后，只需将所有代码替换为以下内容：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Load our local index vector db</span></span>
<span class="line"><span style="color:#ABB2BF;">index </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> FAISS</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">load_local</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;my_faiss_index&quot;</span><span style="color:#ABB2BF;">, embeddings)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># create the prompt template</span></span>
<span class="line"><span style="color:#ABB2BF;">template </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">Please use the following context to answer questions.</span></span>
<span class="line"><span style="color:#98C379;">Context: </span><span style="color:#D19A66;">{context}</span></span>
<span class="line"><span style="color:#98C379;">---</span></span>
<span class="line"><span style="color:#98C379;">Question: </span><span style="color:#D19A66;">{question}</span></span>
<span class="line"><span style="color:#98C379;">Answer: Let&#39;s think step by step.&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Hardcoded question</span></span>
<span class="line"><span style="color:#ABB2BF;">question </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;What is a PLC and what is the difference with a PC&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">matched_docs, sources </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> similarity_search</span><span style="color:#ABB2BF;">(question, index)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Creating the context</span></span>
<span class="line"><span style="color:#ABB2BF;">context </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">([doc.page_content </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> doc </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> matched_docs])</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># instantiating the prompt template and the GPT4All chain</span></span>
<span class="line"><span style="color:#ABB2BF;">prompt </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PromptTemplate</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">template</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">template, </span><span style="color:#E06C75;font-style:italic;">input_variables</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;context&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;question&quot;</span><span style="color:#ABB2BF;">]).</span><span style="color:#61AFEF;">partial</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">context</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">context)</span></span>
<span class="line"><span style="color:#ABB2BF;">llm_chain </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> LLMChain</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">prompt</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">prompt, </span><span style="color:#E06C75;font-style:italic;">llm</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">llm)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Print the result</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(llm_chain.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(question))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>运行之后你会得到一个这样的结果：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">Please</span><span style="color:#98C379;"> use</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> following</span><span style="color:#98C379;"> context</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> answer</span><span style="color:#98C379;"> questions.</span></span>
<span class="line"><span style="color:#61AFEF;">Context:</span><span style="color:#D19A66;"> 1</span><span style="color:#98C379;">.What</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> PLC</span></span>
<span class="line"><span style="color:#61AFEF;">2.Where</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> Why</span><span style="color:#98C379;"> it</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> used</span></span>
<span class="line"><span style="color:#61AFEF;">3.How</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> PLC</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> different</span><span style="color:#98C379;"> from</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> PC</span></span>
<span class="line"><span style="color:#61AFEF;">PLC</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> especially</span><span style="color:#98C379;"> important</span><span style="color:#98C379;"> in</span><span style="color:#98C379;"> industries</span><span style="color:#98C379;"> where</span><span style="color:#98C379;"> safety</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> reliability</span><span style="color:#98C379;"> are</span></span>
<span class="line"><span style="color:#61AFEF;">critical,</span><span style="color:#98C379;"> such</span><span style="color:#98C379;"> as</span><span style="color:#98C379;"> manufacturing</span><span style="color:#98C379;"> plants,</span><span style="color:#98C379;"> chemical</span><span style="color:#98C379;"> plants,</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> power</span><span style="color:#98C379;"> plants.</span></span>
<span class="line"><span style="color:#61AFEF;">How</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> PLC</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> different</span><span style="color:#98C379;"> from</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> PC</span></span>
<span class="line"><span style="color:#61AFEF;">Because</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> PLC</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> specialized</span><span style="color:#98C379;"> computer</span><span style="color:#98C379;"> used</span><span style="color:#98C379;"> in</span><span style="color:#98C379;"> industrial</span><span style="color:#98C379;"> and</span></span>
<span class="line"><span style="color:#61AFEF;">manufacturing</span><span style="color:#98C379;"> applications</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> control</span><span style="color:#98C379;"> machinery</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> processes.,the</span></span>
<span class="line"><span style="color:#61AFEF;">hardware</span><span style="color:#98C379;"> components</span><span style="color:#98C379;"> of</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> typical</span><span style="color:#98C379;"> PLC</span><span style="color:#98C379;"> must</span><span style="color:#98C379;"> be</span><span style="color:#98C379;"> able</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> interact</span><span style="color:#98C379;"> with</span></span>
<span class="line"><span style="color:#61AFEF;">industrial</span><span style="color:#98C379;"> device.</span><span style="color:#98C379;"> So</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> typical</span><span style="color:#98C379;"> PLC</span><span style="color:#98C379;"> hardware</span><span style="color:#98C379;"> include:</span></span>
<span class="line"><span style="color:#61AFEF;">---</span></span>
<span class="line"><span style="color:#61AFEF;">Question:</span><span style="color:#98C379;"> What</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> PLC</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> what</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> difference</span><span style="color:#98C379;"> with</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> PC</span></span>
<span class="line"><span style="color:#61AFEF;">Answer:</span><span style="color:#98C379;"> Let&#39;s think step by step. 1) A Programmable Logic Controller (PLC), </span></span>
<span class="line"><span style="color:#98C379;">also called Industrial Control System or ICS, refers to an industrial computer </span></span>
<span class="line"><span style="color:#98C379;">that controls various automated processes such as manufacturing </span></span>
<span class="line"><span style="color:#98C379;">machines/assembly lines etcetera through sensors and actuators connected </span></span>
<span class="line"><span style="color:#98C379;">with it via inputs &amp; outputs. It is a form of digital computers which has </span></span>
<span class="line"><span style="color:#98C379;">the ability for multiple instruction execution (MIE), built-in memory </span></span>
<span class="line"><span style="color:#98C379;">registers used by software routines, Input Output interface cards(IOC) </span></span>
<span class="line"><span style="color:#98C379;">to communicate with other devices electronically/digitally over networks </span></span>
<span class="line"><span style="color:#98C379;">or buses etcetera</span></span>
<span class="line"><span style="color:#98C379;">2). A Programmable Logic Controller is widely utilized in industrial </span></span>
<span class="line"><span style="color:#98C379;">automation as it has the ability for more than one instruction execution. </span></span>
<span class="line"><span style="color:#98C379;">It can perform tasks automatically and programmed instructions, which allows </span></span>
<span class="line"><span style="color:#98C379;">it to carry out complex operations that are beyond a </span></span>
<span class="line"><span style="color:#98C379;">Personal Computer (PC) capacity. So an ICS/PLC contains built-in memory </span></span>
<span class="line"><span style="color:#98C379;">registers used by software routines or firmware codes etcetera but </span></span>
<span class="line"><span style="color:#98C379;">PC doesn&#39;t</span><span style="color:#98C379;"> contain</span><span style="color:#98C379;"> them</span><span style="color:#98C379;"> so</span><span style="color:#98C379;"> they</span><span style="color:#98C379;"> need</span><span style="color:#98C379;"> external</span><span style="color:#98C379;"> interfaces</span><span style="color:#98C379;"> such</span><span style="color:#98C379;"> as</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;">hard</span><span style="color:#98C379;"> disks</span><span style="color:#98C379;"> drives</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">HDD</span><span style="color:#ABB2BF;">)</span><span style="color:#98C379;">,</span><span style="color:#98C379;"> USB</span><span style="color:#98C379;"> ports,</span><span style="color:#98C379;"> serial</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> parallel</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;">communication</span><span style="color:#98C379;"> protocols</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> store</span><span style="color:#98C379;"> data</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> further</span><span style="color:#98C379;"> analysis</span><span style="color:#98C379;"> or</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;">report</span><span style="color:#98C379;"> generation.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>如果你希望使用用户输入来替换问题：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">question </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;What is a PLC and what is the difference with a PC&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>就像下面这样：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">question </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Your question: &quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h3><p>现在是你进行实验的时候了。对与你的文档相关的所有主题提出不同的问题，并观察结果。在 Prompt 和模板方面，肯定还有很大的改进空间：你可以在这里找到一些灵感。而且 Langchain 的文档真的很棒（我都能够理解！）。</p><h2 id="minigpt-4" tabindex="-1">MiniGPT-4 <a class="header-anchor" href="#minigpt-4" aria-label="Permalink to &quot;MiniGPT-4&quot;">​</a></h2><p>近日，来自阿卜杜拉国王科技大学的研究团队，便提出了一个具有类似 GPT-4 图像理解与对话能力的 AI 大模型——MiniGPT-4，并将其开源<img src="`+s+'" alt="[哇]">。</p><p>据介绍，MiniGPT-4 具有出色的多模态能力，如从手写草稿创建网站、生成详细的图像描述、根据图像创作故事和诗歌、为图像中描述的问题提供解决方案，以及根据食物照片教对话对象如何烹饪一道美味的菜品等<img src="'+s+'" alt="[让我看看]">。</p><p>在技术层面上，MiniGPT-4 由一个带有预训练的 ViT 和 Q-Former 的视觉编码器、一个单一的线性投影层和一个 Vicuna 大语言模型组成。而且，MiniGPT-4 只需要训练线性层，使视觉特征与 Vicuna 保持一致。</p><p>有 Y Combinator 用户这样评价 MiniGPT-4，“在技术层面上，他们正在做一些非常简单的事情......但结果非常惊人。最重要的是，它在 OpenAI 的 GPT-4 图像模态之前出现。（这是）开源 AI 的真正胜利。”</p><p>也有用户表示，“我认为他们为一个不相关的项目使用 GPT-4 名称是一种糟糕的形式。毕竟，底层的 Vicuna 只是一个微调的 LLaMA。另外，他们使用了较小的 13B 版本。然而，结果看起来很有趣。”</p><p>图文生成</p><p>本地电脑直接部署运行：要求显存12G</p><p>开源地址：<a href="https://github.com/Vision-CAIR/MiniGPT-4" target="_blank" rel="noreferrer">https://github.com/Vision-CAIR/MiniGPT-4</a></p><p>项目体验地址：<a href="https://minigpt-4.github.io/" target="_blank" rel="noreferrer">minigpt-4.github.io/</a></p><p>项目作者认为，GPT-4 所实现的多模态能力，在以前的视觉 - 语言模型中很少见，因此认为，GPT-4 先进的多模态生成能力，主要原因在于利用了更先进的大型语言模型。</p><p>为了验证这一想法，团队成员将一个冻结的视觉编码器与一个冻结的 Vicuna 进行对齐，造出了 MiniGPT-4。</p><p><img src="'+F+'" alt="图片"></p><p>在研究中，他们发现 MiniGPT-4 具有许多类似于 GPT-4 的能力，如详细的图像描述生成、从手写草稿创建网站等。</p><p>不仅如此，他们还在研究中还收获了意想不到的惊喜，除了能实现上述功能之外，MiniGPT-4 还能根据图像创作故事和诗歌，为图像中显示的问题提供解决方案，教用户如何根据食物照片做饭等。</p><p>下面给大家看几个示例。</p><p>拍一张菜品图片，让 AI 自动帮你生成菜谱：</p><p><img src="'+C+'" alt="image.png"></p><p>让 AI 描述图像内容：</p><p><img src="'+h+'" alt="图片"></p><p>通过商品图，直接生成广告文案：</p><p><img src="'+f+'" alt="图片"></p><p>根据实验结果表明，GPT-4 这些先进的能力，理论上可以归因于它使用了更先进的大语言模型。</p><p>也就是说，未来在图像、声音、视频等领域，基于这些大语言模型所造出来的应用，其实际效果都不会太差。</p><p>这个项目证实了大语言模型在图像领域的可行性，接下来应该会有不少开发者入场，将 GPT-4 的能力进一步往音频、视频等领域延伸，进而让我们得以看到更多有趣、令人惊艳的 AI 应用。</p><p>迄今为止，GPT-4 凭借多模态能力已经成为 AI 领域备受关注的大模型，可以利用手写文本生成网站并且还能够识别出图片中的幽默元素，这些优秀的能力在以前的视觉语言模型中很难实现。那么能否利用目前比较先进的大型LLM进行微调从而尽可能达到GPT-4的性能呢？作者团队因此提出了MiniGPT-4。</p><p>经过验证，MiniGPT-4在文本方面可以达到90% ChatGPT的能力，在视觉感知方面，同样具备与GPT-4的多模态功能。 <a href="https://minigpt-4.github.io/" target="_blank" rel="noreferrer"><strong>官网</strong></a> | <a href="https://github.com/Vision-CAIR/MiniGPT-4" target="_blank" rel="noreferrer"><strong>GitHub</strong></a> | <a href="https://mp.weixin.qq.com/s/Ir3cg8HYOPP5upGIwolF1A" target="_blank" rel="noreferrer"><strong>中文解读</strong></a></p><h2 id="cyberwaifu开源聊天机器人-hatgpt-claude" tabindex="-1">CyberWaifu开源聊天机器人 hatGPT+Claude <a class="header-anchor" href="#cyberwaifu开源聊天机器人-hatgpt-claude" aria-label="Permalink to &quot;CyberWaifu开源聊天机器人 hatGPT+Claude&quot;">​</a></h2><p>【【CyberWaifu开源发布，ChatGPT+Claude】我要给她完整的一生，引入思考链和记忆数据库】<a href="https://www.bilibili.com/video/BV11V4y1z7rS?vd_source=36c9491a7fa2ab8a22ca060af01b7472" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV11V4y1z7rS?vd_source=36c9491a7fa2ab8a22ca060af01b7472</a></p><p>开源地址：<a href="https://github.com/Syan-Lin/CyberWaifu" target="_blank" rel="noreferrer">https://github.com/Syan-Lin/CyberWaifu</a></p><h3 id="使用-chato-搭建自己的知识库-轻松定制-chatgpt-智能问答机器人" tabindex="-1">使用 Chato 搭建自己的知识库 | 轻松定制 ChatGPT 智能问答机器人 <a class="header-anchor" href="#使用-chato-搭建自己的知识库-轻松定制-chatgpt-智能问答机器人" aria-label="Permalink to &quot;使用 Chato 搭建自己的知识库 | 轻松定制 ChatGPT 智能问答机器人&quot;">​</a></h3><p>体验地址：<a href="https://chato.cn/" target="_blank" rel="noreferrer">https://chato.cn/</a></p><p>Chato是一款强大而易用的工具，能帮助你将垂直行业知识注入AI，并创建属于自己的AI助手。无需编程，通过上传文档或回答问题，Chato自动学习并建立知识库。你可以设定机器人角色、定制个性，并灵活发布到各渠道。</p><h2 id="chatgpt实时语音聊天" tabindex="-1">ChatGPT实时语音聊天 <a class="header-anchor" href="#chatgpt实时语音聊天" aria-label="Permalink to &quot;ChatGPT实时语音聊天&quot;">​</a></h2><p>ChatGPT+VITS+Galgame</p><p>【ChatGPT+Galgame 与老婆自由对话！】<a href="https://www.bilibili.com/video/BV1TD4y1E7e8?vd_source=36c9491a7fa2ab8a22ca060af01b7472" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV1TD4y1E7e8?vd_source=36c9491a7fa2ab8a22ca060af01b7472</a></p><p>项目地址：<a href="https://github.com/cjyaddone/ChatWaifu" target="_blank" rel="noreferrer">https://github.com/cjyaddone/ChatWaifu</a> L2D版本：<a href="https://github.com/cjyaddone/ChatWaifuL2D" target="_blank" rel="noreferrer">https://github.com/cjyaddone/ChatWaifuL2D</a> QQ机器人版本：<a href="https://github.com/MuBai-He/ChatWaifu-marai" target="_blank" rel="noreferrer">https://github.com/MuBai-He/ChatWaifu-marai</a></p>',172),_=[D];function E(P,v,k,q,w,T){return l(),a("div",null,_)}const x=n(g,[["render",E]]);export{L as __pageData,x as default};
